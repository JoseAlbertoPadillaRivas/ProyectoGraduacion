@{
    ViewBag.Title = "AdminCalificacion";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<head>
    <link href="~/root/dist/css/stylesCalificaciones.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet" />
</head>

<!-- Botones para analizar y exportar calificaciones -->
<div class="d-flex justify-content-end mb-3">
    <a class="btn btn-info mx-2" href=@Url.Action("AnalizarCalificaciones","Calificacion")>Analizar Calificaciones</a>
    <button id="exportButton" class="btn btn-success">Exportar Datos</button>
</div>

<!-- Barra de búsqueda y filtros por mes y año -->
<div class="d-flex justify-content-between mb-3">
    <div>
        <input type="text" id="searchInput" placeholder="Buscar..." class="form-control">
    </div>
    <div>
        <select id="filterMonthYear" class="form-select">
            <option value="">Filtrar por Mes y Año</option>
            <option value="enero-2024">Enero 2024</option>
            <option value="febrero-2024">Febrero 2024</option>
            <option value="marzo-2024">Marzo 2024</option>
            <!-- Agrega más opciones de meses y años según sea necesario -->
        </select>

    </div>
</div>

<!-- Tarjetas de calificaciones -->
<div class="row">
    <!-- Ejemplo de tarjeta 1 -->
    <div class="card text-center col-3 mx-2">
        <div class="card-header">
            Paciente: Josue Herrera
        </div>
        <div class="card-body">
            <h5 class="card-title">Limpieza Dental</h5>
            <p class="card-text">Comentario sobre la limpieza dental realizada en enero de 2024.</p>
            <div class="card-footer text-body-secondary">
                <i class="fa-solid fa-star" style="color:yellow"></i>
                <i class="fa-solid fa-star" style="color:yellow"></i>
                <i class="fa-solid fa-star" style="color:yellow"></i>
                <i class="fa-solid fa-star" style="color:yellow"></i>
                <i class="fa-solid fa-star" style="color:yellow"></i>
            </div>
            <div class="mt-2">
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#ModalVerCalificacion">
                    Ver
                </button>
                <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#ModalCalificacion">
                    Eliminar
                </button>
            </div>
        </div>
    </div>

    <!-- Ejemplo de tarjeta 2 -->
    <div class="card text-center col-3 mx-2">
        <div class="card-header">
            Paciente: Maria Pérez
        </div>
        <div class="card-body">
            <h5 class="card-title">Ortodoncia</h5>
            <p class="card-text">Comentario sobre la ortodoncia realizada en enero de 2024.</p>
            <div class="card-footer text-body-secondary">
                <i class="fa-solid fa-star" style="color:yellow"></i>
                <i class="fa-solid fa-star" style="color:yellow"></i>
                <i class="fa-solid fa-star" style="color:yellow"></i>
                <i class="fa-solid fa-star" style="color:yellow"></i>
                <i class="fa-solid fa-star" style="color:gray"></i>
            </div>
            <div class="mt-2">
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#ModalVerCalificacion">
                    Ver
                </button>
                <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#ModalCalificacion">
                    Eliminar
                </button>
            </div>
        </div>
    </div>

    <!-- Ejemplo de tarjeta 3 -->
    <div class="card text-center col-3 mx-2">
        <div class="card-header">
            Paciente: Carlos Gómez
        </div>
        <div class="card-body">
            <h5 class="card-title">Extracción de Molar</h5>
            <p class="card-text">Comentario sobre la extracción realizada en febrero de 2024.</p>
            <div class="card-footer text-body-secondary">
                <i class="fa-solid fa-star" style="color:yellow"></i>
                <i class="fa-solid fa-star" style="color:yellow"></i>
                <i class="fa-solid fa-star" style="color:yellow"></i>
                <i class="fa-solid fa-star" style="color:yellow"></i>
                <i class="fa-solid fa-star" style="color:gray"></i>
            </div>
            <div class="mt-2">
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#ModalVerCalificacion">
                    Ver
                </button>
                <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#ModalCalificacion">
                    Eliminar
                </button>
            </div>
        </div>
    </div>

    <!-- Ejemplo de tarjeta 4 -->
    <div class="card text-center col-3 mx-2">
        <div class="card-header">
            Paciente: Laura Rodríguez
        </div>
        <div class="card-body">
            <h5 class="card-title">Endodoncia</h5>
            <p class="card-text">Comentario sobre la endodoncia realizada en febrero de 2024.</p>
            <div class="card-footer text-body-secondary">
                <i class="fa-solid fa-star" style="color:yellow"></i>
                <i class="fa-solid fa-star" style="color:yellow"></i>
                <i class="fa-solid fa-star" style="color:yellow"></i>
                <i class="fa-solid fa-star" style="color:yellow"></i>
                <i class="fa-solid fa-star" style="color:yellow"></i>
            </div>
            <div class="mt-2">
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#ModalVerCalificacion">
                    Ver
                </button>
                <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#ModalCalificacion">
                    Eliminar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para ver calificación (Usado para todas las tarjetas) -->
<div class="modal fade" id="ModalVerCalificacion" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Detalle de la Calificación</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p><strong>Paciente:</strong> Josue Herrera</p>
                <p><strong>Título:</strong> Limpieza Dental</p>
                <p><strong>Comentario:</strong> Comentario sobre la limpieza dental realizada en enero de 2024.</p>
                <p>
                    <strong>Calificación:</strong>
                    <i class="fa-solid fa-star" style="color:yellow"></i>
                    <i class="fa-solid fa-star" style="color:yellow"></i>
                    <i class="fa-solid fa-star" style="color:yellow"></i>
                    <i class="fa-solid fa-star" style="color:yellow"></i>
                    <i class="fa-solid fa-star" style="color:yellow"></i>
                </p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para confirmar eliminación -->
<div class="modal fade" id="ModalCalificacion" data-backdrop="static" data-keyboard="false" tabindex="-1"
     aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Confirmación</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                ¿Desea eliminar la calificación de: Josué Herrera?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-success">Confirmar</button>
            </div>
        </div>
    </div>
</div>

<script>
    document.getElementById('searchInput').addEventListener('keyup', function () {
        let filter = this.value.toLowerCase();
        let cards = document.querySelectorAll('.card');

        cards.forEach(function (card) {
            let text = card.textContent.toLowerCase();
            if (text.includes(filter)) {
                card.style.display = '';
            } else {
                card.style.display = 'none';
            }
        });
    });

    document.getElementById('filterMonthYear').addEventListener('change', function () {
        let selectedMonthYear = this.value.toLowerCase();
        let cards = document.querySelectorAll('.card');

        cards.forEach(function (card) {
            let monthYearText = card.querySelector('.card-body').textContent.toLowerCase();
            if (selectedMonthYear === "" || monthYearText.includes(selectedMonthYear)) {
                card.style.display = '';
            } else {
                card.style.display = 'none';
            }
        });
    });

    document.getElementById('exportButton').addEventListener('click', function() {
    Swal.fire({
        title: '¿Desea descargar el reporte?',
        icon: 'question',
        showCancelButton: true,
        confirmButtonText: 'Sí',
        cancelButtonText: 'No'
    }).then((result) => {
        if (result.isConfirmed) {
            Swal.fire(
                'Descarga Iniciada',
                'El reporte se está descargando.',
                'success'
            ).then(() => {
                // Redirige de nuevo a la misma página
                window.location.href = '@Url.Action("AdminCalificacion", "Calificacion")';
            });
        }
    });
});
</script>

